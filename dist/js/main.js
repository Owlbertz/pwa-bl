"use strict";var _this=this;Node.prototype.q=function(e){return this.querySelector(e)},Node.prototype.qA=function(e){var t=this.querySelectorAll(e);return t.length?t:[]},Node.prototype.on=function(e,t){return this.addEventListener(e,t)},Node.prototype.attr=function(e,t){return this.setAttribute(e,t)},NodeList.prototype.forEach=HTMLCollection.prototype.forEach=Array.prototype.forEach,"remove"in Element.prototype||(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)}),document.body.classList.remove("no-js");var App=function(){var e=function(e){return new Promise(function(t,n){var o=new XMLHttpRequest;o.open("GET",e,!0),o.onload=function(){200===o.status?t(o.responseText):(void 0,n(new Error(o.statusText)))},o.onerror=function(t){void 0,n(t)},o.send()})},t=[],n=function(e){return"string"==typeof e&&(e=[e]),new Promise(function(n,o){var i=0,a=function(t){++i===e.length&&(void 0,n())};e.forEach(function(e){if(t.indexOf(e)>-1)return void a(e);t.push(e);var n=e.indexOf(".js")!==-1?"js":"css";if("js"===n){var o=document.createElement("script");o.attr("src",e),o.onload=a,document.q("body").appendChild(o)}else if("css"===n){var i=document.createElement("link");i.attr("rel","stylesheet"),i.attr("href",e),i.onload=a,document.q("head").appendChild(i)}})})},o=function(e){return new Promise(function(t,n){document.qA(".result:not(.template)").forEach(function(e){e.remove()});var o=document.q(".result.template"),i=document.q(".results"),a=document.createDocumentFragment();e.forEach(function(e){var t=o.cloneNode(!0),n=t.q(".more-container"),i=n.q(".goals"),r=(n.q(".predictions"),t.q(".shore-more-button"));t.classList.remove("template"),t.attr("data-match-id",e.MatchID),t.q(".team1-name").textContent=e.Team1.TeamName,t.q(".team2-name").textContent=e.Team2.TeamName,_this.online&&(t.q(".team1-icon").attr("src",e.Team1.TeamIconUrl.replace("http:",location.protocol)),t.q(".team1-icon").attr("alt",e.Team1.TeamName+" icon"),t.q(".team1-icon").on("load",function(){this.classList.add("loaded")}),t.q(".team2-icon").attr("src",e.Team2.TeamIconUrl.replace("http:",location.protocol)),t.q(".team2-icon").attr("alt",e.Team2.TeamName+" icon"),t.q(".team2-icon").on("load",function(){this.classList.add("loaded")})),t.q(".time").textContent=App.Util.dateParser(new Date(e.MatchDateTimeUTC));var s="more-container-"+e.MatchID;n.attr("id",s),r.attr("aria-controls",s),r.on("click",function(e){var t="true"===this.getAttribute("aria-expanded");t?(this.attr("aria-expanded",!1),n.classList.remove("open"),this.attr("title","Show additional information")):(this.attr("aria-expanded",!0),n.classList.add("open"),this.attr("title","Hide additional information"))}),e.MatchIsFinished?!function(){t.classList.add("finished");var n=2===e.MatchResults[0].ResultOrderID?0:1;t.q(".points-team1").textContent=e.MatchResults[n].PointsTeam1,t.q(".points-team2").textContent=e.MatchResults[n].PointsTeam2;var o=0,a=0;e.Goals.forEach(function(t){var n=void 0;t.ScoreTeam1>o?(n=1,o=t.ScoreTeam1):(n=2,a=t.ScoreTeam2);var r=i.q(".heading"),s=i.q("li.template").cloneNode(!0);r.attr("id","goals-heading-"+e.MatchID),s.classList.add("goal-team-"+n),s.classList.remove("template");var l=t.GoalGetterName||'<span class="visuallyhidden">Unknown</span><span aria-hidden="true">???</span>';s.q(".goal-scorer").innerHTML=l+'<span class="visuallyhidden">for team: '+e["Team"+n].TeamName+"</span>";var c=t.MatchMinute||'<span class="visuallyhidden">Unknown</span><span aria-hidden="true">??</span>';s.q(".goal-time").innerHTML=c,i.q("ul").attr("aria-labelledby","goals-heading-"+e.MatchID),i.q("ul").appendChild(s)})}():new Date(e.MatchDateTime)<new Date?t.classList.add("ongoing"):(t.classList.add("not-started"),i.classList.add("hide")),App.Predictions?App.Predictions.render(t,e):(e.MatchIsFinished||r.classList.add("hide"),void 0),a.appendChild(t)}),i.appendChild(a),App.Points?Promise.all([App.Store.open("data").then(function(){return App.Store.getAll("data")}),App.Store.open("predictions").then(function(){return App.Store.getAllPerIndex("predictions")})]).then(function(e){var n=e[0],o=e[1];App.Points.renderAllPoints(document.q("#prediction-points-container"),n,o),document.q(".points-button").classList.remove("hide"),t()}):t()})};return{online:!1,init:function(){App.Features.serviceWorker&&navigator.serviceWorker.register("./worker.js").then(function(e){void 0}).catch(function(e){void 0});var e=["js/util.js"];App.Features.store&&e.push("js/store.js"),App.Features.predictions&&(e.push("js/predictions.js"),e.push("js/points.js")),n(e).then(function(){return window.addEventListener("online",function(e){App.loadResults(),App.online=!0},!1),window.addEventListener("offline",function(e){App.online=!1},!1),navigator.onLine&&(App.online=!0),App.loadResults()}).then(function(){App.Navigation&&App.Navigation.render(),App.Points&&App.Store&&!function(){var e=document.q(".points-button"),t=document.q("#prediction-points-container");e.on("click",function(e){var n="true"===this.getAttribute("aria-expanded");n?(this.attr("aria-expanded",!1),this.attr("title","Show points"),this.q("span").innerHTML="&empty;",document.q("body").classList.remove("points-visible")):(this.attr("aria-expanded",!0),this.attr("title","Hide points"),this.q("span").innerHTML="&times;",document.q("body").classList.add("points-visible"),t.focus())})}(),n(["css/fonts.css"]),App.hideLoading()})},loadResults:function(t){App.showLoading(),App.hideOffline();var n=this.Navigation.getSelectedWeek(),i=location.protocol||"https:",a=i+"//www.openligadb.de/api/getmatchdata/bl1/2016/"+n,r=void 0,s=function(){return e(a).then(function(e){var t=JSON.parse(e);return App.store&&App.Store.open("data").then(function(){return App.Store.add("data",n,t)}),t},function(e){return t?App.showNotice("Unable to fetch data."):App.showOffline()})};return r=App.Store&&!t?App.Store.open("data").then(function(){return App.Store.get("data",n)}).then(function(e){return e?e:s()}):e(a).then(function(e){var t=JSON.parse(e);return App.Features.store&&App.Store.open("data").then(function(){return App.Store.add("data",n,t)}),t},function(e){return t?App.showNotice("Unable to fetch data."):App.showOffline()}),r.then(function(e){return e?o(e):t?void 0:App.showOffline()}).then(function(){return App.hideLoading()})},showOffline:function(){if(!this.offlineMessageVisible)return this.offline=!0,this.online=!1,this.offlineMessageVisible=!0,e("offline.html").then(function(e){return new Promise(function(t,n){var o=document.createElement("div");o.attr("id","offline-container"),o.innerHTML=e,document.q("#results-container").appendChild(o),document.q("body").classList.add("offline"),t()})})},hideOffline:function(){if(this.offlineMessageVisible){this.offline=!1,this.online=!0,this.offlineMessageVisible=!1;var e=document.q("#offline-container");e&&e.remove(),document.q("body").classList.remove("offline")}},showNotice:function(e){return new Promise(function(t,n){var o=document.createElement("div");o.classList.add("notice"),o.innerHTML=e,document.q("#container").appendChild(o),setTimeout(function(){o.remove()},5e3),t()})},showLoading:function(){this.loading=!0,this.startedLoading=new Date,document.q("body").classList.add("loading"),document.q("#container").attr("aria-busy",!0),clearTimeout(this.loadTimeout)},hideLoading:function(){var e=this,t=new Date-this.startedLoading,n=function(){e.loading=!1,document.q("body").classList.remove("loading"),document.q("#container").removeAttribute("aria-busy"),clearTimeout(e.loadTimeout)};t>500?n():this.loadTimeout=setTimeout(n,500-t)},Features:{predictions:"indexedDB"in window,store:"indexedDB"in window,serviceWorker:"serviceWorker"in navigator,touch:"ontouchstart"in window},Navigation:function(){var e=new Date;e.setMinutes(0),e.setHours(0),e.setSeconds(0),e.setMilliseconds(0);var t=new Date("2016-08-25T00:00:00"),o=6048e5,i=1+Math.floor((e-t)/o),a=!1,r=/#!\d{1,2}/,s=function(e){location.hash.match(r)?location.hash=location.hash.replace(r,"#!"+e):location.hash="#!"+e+location.hash},l=function(){var e=location.hash.match(r);if(!e)return null;try{return parseInt(e[0].replace("#!",""))}catch(e){return void 0,null}},c=l()||i;return{getSelectedWeek:function(){return c},next:function(){c++,s(c)},prev:function(){c--,s(c)},isPrev:function(){return c>1},isNext:function(){return c<34},render:function(){var e=this,t=document.q("nav"),o=t.q(".prev"),i=t.q(".next");this.isPrev()?o.removeAttribute("disabled"):o.attr("disabled",!0),this.isNext()?i.removeAttribute("disabled"):i.attr("disabled",!0),t.q(".current-week").textContent=this.getSelectedWeek(),a||!function(){var t=function(t){!App.loading&&e.isNext()&&(e.next(),e.render(),App.loadResults())},r=function(t){!App.loading&&e.isPrev()&&(e.prev(),e.render(),App.loadResults())};App.Features.touch&&n("js/touch.js").then(function(){document.on("swipeleft",t),document.on("swiperight",r)}),i.on("click",t),o.on("click",r),a=!0}()}}}()}}(),_polyfillsLoaded=0,_polyFillCallback=function(){2===++_polyfillsLoaded&&App.init()};if("undefined"!=typeof Promise&&Promise.toString().indexOf("[native code]")!==-1)_polyFillCallback();else{var promisePolyfill=document.createElement("script");promisePolyfill.attr("src","js/shims/promise.js"),promisePolyfill.onload=function(){_polyFillCallback()},document.q("body").appendChild(promisePolyfill)}if("undefined"!=typeof IDBObjectStore.prototype.getAll&&IDBObjectStore.prototype.getAll.toString().indexOf("[native code]")!==-1)_polyFillCallback();else{var getAllPolyfill=document.createElement("script");getAllPolyfill.attr("src","js/shims/indexeddb-getall-shim.js"),getAllPolyfill.onload=function(){_polyFillCallback()},document.q("body").appendChild(getAllPolyfill)}