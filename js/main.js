"use strict";var _this2=this;Node.prototype.q=function(t){return this.querySelector(t)},Node.prototype.qA=function(t){return this.querySelectorAll(t)},Node.prototype.on=function(t,e){return this.addEventListener(t,e)},Node.prototype.attr=function(t,e){return this.setAttribute(t,e)};var App=function(){var t=function(t){return new Promise(function(e,n){var i=new XMLHttpRequest;i.open("GET",t,!0),i.onload=function(){200===i.status?e(i.responseText):(void 0,n(new Error(i.statusText)))},i.onerror=function(e){void 0,n(e)},i.send()})},e=[],n=function(t){return"string"==typeof t&&(t=[t]),new Promise(function(n,i){var o=0,a=function(e){++o===t.length&&(void 0,n())};t.forEach(function(t){if(e.indexOf(t)>-1)return void a(t);e.push(t);var n=t.indexOf(".js")!==-1?"js":"css";if("js"===n){var i=document.createElement("script");i.attr("src",t),i.onload=a,document.q("body").appendChild(i)}else if("css"===n){var o=document.createElement("link");o.attr("rel","stylesheet"),o.attr("href",t),o.onload=a,document.q("head").appendChild(o)}})})},i=function(t){return new Promise(function(e,n){document.qA(".result:not(.template)").forEach(function(t){t.remove()});var i=document.q(".result.template"),o=document.q(".results"),a=document.createDocumentFragment();t.forEach(function(t){var e=i.cloneNode(!0),n=e.q(".more-container"),o=n.q(".goals"),r=(n.q(".predictions"),e.q(".shore-more-button"));e.classList.remove("template"),e.attr("data-match-id",t.MatchID),e.q(".team1-name").textContent=t.Team1.TeamName,e.q(".team2-name").textContent=t.Team2.TeamName,_this2.online&&(e.q(".team1-icon").attr("src",t.Team1.TeamIconUrl.replace("http:",location.protocol)),e.q(".team1-icon").attr("alt",t.Team1.TeamName+" icon"),e.q(".team1-icon").on("load",function(){this.classList.add("loaded")}),e.q(".team2-icon").attr("src",t.Team2.TeamIconUrl.replace("http:",location.protocol)),e.q(".team2-icon").attr("alt",t.Team2.TeamName+" icon"),e.q(".team2-icon").on("load",function(){this.classList.add("loaded")})),e.q(".time").textContent=App.Util.dateParser(new Date(t.MatchDateTimeUTC));var s="more-container-"+t.MatchID;n.attr("id",s),r.attr("aria-controls",s),r.on("click",function(t){var e="true"===this.getAttribute("aria-expanded");e?(this.attr("aria-expanded",!1),n.classList.remove("open"),this.attr("title","Show additional information")):(this.attr("aria-expanded",!0),n.classList.add("open"),this.attr("title","Hide additional information"))}),t.MatchIsFinished?!function(){e.classList.add("finished");var n=2===t.MatchResults[0].ResultOrderID?0:1;e.q(".points-team1").textContent=t.MatchResults[n].PointsTeam1,e.q(".points-team2").textContent=t.MatchResults[n].PointsTeam2;var i=0,a=0;t.Goals.forEach(function(e){var n=void 0;e.ScoreTeam1>i?(n=1,i=e.ScoreTeam1):(n=2,a=e.ScoreTeam2);var r=o.q(".heading"),s=o.q("li.template").cloneNode(!0);r.attr("id","goals-heading-"+t.MatchID),s.classList.add("goal-team-"+n),s.classList.remove("template");var c=e.GoalGetterName||'<span class="visuallyhidden">Unknown</span><span aria-hidden="true">???</span>';s.q(".goal-scorer").innerHTML=c+'<span class="visuallyhidden">for team: '+t["Team"+n].TeamName+"</span>";var d=e.MatchMinute||'<span class="visuallyhidden">Unknown</span><span aria-hidden="true">??</span>';s.q(".goal-time").innerHTML=d,o.q("ul").attr("aria-labelledby","goals-heading-"+t.MatchID),o.q("ul").appendChild(s)})}():new Date(t.MatchDateTime)<new Date?e.classList.add("ongoing"):(e.classList.add("not-started"),o.classList.add("hide")),App.Predictions?App.Predictions.render(e,t):(t.MatchIsFinished||r.classList.add("hide"),void 0),a.appendChild(e)}),o.appendChild(a),e()})};return{online:!1,init:function(){App.Features.serviceWorker&&navigator.serviceWorker.register("./worker.js").then(function(t){void 0}).catch(function(t){void 0});var t=["js/util.js","css/fonts.css"];App.Features.store&&t.push("js/store.js"),App.Features.predictions&&(t.push("js/predictions.js"),t.push("js/points.js")),n(t).then(function(){return window.addEventListener("online",function(t){App.loadResults(),App.online=!0},!1),window.addEventListener("offline",function(t){App.online=!1},!1),navigator.onLine&&(App.online=!0),App.loadResults()}).then(function(){App.Navigation&&App.Navigation.render(),App.Points&&App.Store&&!function(){var t=document.q(".points-button"),e=document.q("#prediction-points-container");t.on("click",function(t){var n="true"===this.getAttribute("aria-expanded");n?(this.attr("aria-expanded",!1),this.attr("title","Show points"),this.q("span").innerHTML="&empty;",document.q("body").classList.remove("points-visible")):(this.attr("aria-expanded",!0),this.attr("title","Hide points"),this.q("span").innerHTML="&times;",document.q("body").classList.add("points-visible"),e.focus())}),Promise.all([App.Store.open("data").then(function(){return App.Store.getAll("data")}),App.Store.open("predictions").then(function(){return App.Store.getAll("predictions")})]).then(function(e){var n=e[0],i=e[1];App.Points.renderAllPoints(document.q("#prediction-points-container"),n,i),t.classList.remove("hide")})}(),App.hideLoading()})},loadResults:function(e){App.showLoading(),App.hideOffline();var n=this.Navigation.getSelectedWeek(),o=location.protocol||"https:",a=o+"//www.openligadb.de/api/getmatchdata/bl1/2016/"+n,r=void 0,s=function(){return t(a).then(function(t){var e=App.Util.resultParser(t);return App.store&&App.Store.open("data").then(function(){return App.Store.add("data",n,e)}),e},function(t){return e?App.showNotice("Unable to fetch data."):App.showOffline()})};return r=App.Store&&!e?App.Store.open("data").then(function(){return App.Store.get("data",n)}).then(function(t){return t?t:s()}):t(a).then(function(t){var e=App.Util.resultParser(t);return App.Features.store&&App.Store.open("data").then(function(){return App.Store.add("data",n,e)}),e},function(t){return e?App.showNotice("Unable to fetch data."):App.showOffline()}),r.then(function(t){return t?i(t):e?void 0:App.showOffline()}).then(function(){return App.hideLoading()})},showOffline:function(){if(!this.offlineMessageVisible)return this.offline=!0,this.online=!1,this.offlineMessageVisible=!0,t("offline.html").then(function(t){return new Promise(function(e,n){var i=document.createElement("div");i.attr("id","offline-container"),i.innerHTML=t,document.q("#results-container").appendChild(i),document.q("body").classList.add("offline"),e()})})},hideOffline:function(){if(this.offlineMessageVisible){this.offline=!1,this.online=!0,this.offlineMessageVisible=!1;var t=document.q("#offline-container");t&&t.remove(),document.q("body").classList.remove("offline")}},showNotice:function(t){return new Promise(function(e,n){var i=document.createElement("div");i.classList.add("notice"),i.innerHTML=t,document.q("#container").appendChild(i),setTimeout(function(){i.remove()},5e3),e()})},showLoading:function(){this.loading=!0,this.startedLoading=new Date,document.q("body").classList.add("loading"),document.q("#container").attr("aria-busy",!0),clearTimeout(this.loadTimeout)},hideLoading:function(){var t=this,e=new Date-this.startedLoading,n=function(){t.loading=!1,document.q("body").classList.remove("loading"),document.q("#container").removeAttribute("aria-busy"),clearTimeout(t.loadTimeout)};e>500?n():this.loadTimeout=setTimeout(n,500-e)},Features:{predictions:"indexedDB"in window,store:"indexedDB"in window,serviceWorker:"serviceWorker"in navigator,touch:"ontouchstart"in window},Navigation:function(){var t=new Date;t.setMinutes(0),t.setHours(0),t.setSeconds(0),t.setMilliseconds(0);var e=new Date("2016-08-25T00:00:00"),i=6048e5,o=1+Math.floor((t-e)/i),a=!1,r=/#!\d{1,2}/,s=function(t){location.hash.match(r)?location.hash=location.hash.replace(r,"#!"+t):location.hash="#!"+t+location.hash},c=function(){var t=location.hash.match(r);if(!t)return null;try{return parseInt(t[0].replace("#!",""))}catch(t){return void 0,null}},d=c()||o;return{getSelectedWeek:function(){return d},next:function(){d++,s(d)},prev:function(){d--,s(d)},isPrev:function(){return d>1},isNext:function(){return d<34},render:function(){var t=this,e=document.q("nav"),i=e.q(".prev"),o=e.q(".next");this.isPrev()?i.removeAttribute("disabled"):i.attr("disabled",!0),this.isNext()?o.removeAttribute("disabled"):o.attr("disabled",!0),e.q(".current-week").textContent=this.getSelectedWeek(),a||!function(){var e=function(e){!App.loading&&t.isNext()&&(t.next(),t.render(),App.loadResults())},r=function(e){!App.loading&&t.isPrev()&&(t.prev(),t.render(),App.loadResults())};App.Features.touch&&n("js/touch.js").then(function(){document.on("swipeleft",e),document.on("swiperight",r)}),o.on("click",e),i.on("click",r),a=!0}()}}}()}}();App.init();