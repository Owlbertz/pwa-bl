var isOnline=-1!==location.hash.indexOf('online'),isOffline=-1!==location.hash.indexOf('offline'),useLocal=-1!==location.hash.indexOf('local');Node.prototype.q=function(a){return this.querySelector(a)},Node.prototype.qA=function(a){return this.querySelectorAll(a)};var App=(()=>{var a=g=>{return new Promise((h,i)=>{var j=new XMLHttpRequest;j.open('GET',g,!0),j.onload=()=>{var k=-1===g.indexOf('http');k||200===j.status?k?setTimeout(function(){h(j.responseText)},2000):h(j.responseText):(void 0,i(new Error(j.statusText)))},j.onerror=k=>{void 0,i(k)},j.send()})},b=[],c=g=>{return'string'==typeof g&&(g=[g]),new Promise((h,i)=>{let j=0,k=l=>{++j===g.length&&(void 0,h())};g.forEach(l=>{if(-1<b.indexOf(l))return void k(l);b.push(l);var m=-1===l.indexOf('.js')?'css':'js';if('js'==m){var n=document.createElement('script');n.setAttribute('src',l),n.onload=k,'undefined'!=typeof n&&document.q('body').appendChild(n)}else if('css'==m){var n=document.createElement('link');n.setAttribute('rel','stylesheet'),n.setAttribute('href',l),n.onload=k,'undefined'!=typeof n&&document.q('body').appendChild(n)}})})},f=g=>{return new Promise((h,i)=>{document.qA('.result:not(.template)').forEach(l=>{l.remove()});var j=document.q('.result.template'),k=document.q('.results');g.forEach(l=>{var m=j.cloneNode(!0),n=m.q('.more-container'),o=n.q('.goals');predictionsContainer=n.q('.predictions'),showMoreButton=m.q('.shore-more-button'),m.classList.remove('template'),m.setAttribute('data-match-id',l.MatchID),m.q('.team1-name').textContent=l.Team1.TeamName,m.q('.team2-name').textContent=l.Team2.TeamName,m.q('.team1-icon').setAttribute('src',l.Team1.TeamIconUrl),m.q('.team1-icon').setAttribute('alt',l.Team1.TeamName+' icon'),m.q('.team1-icon').addEventListener('load',function(){this.classList.add('loaded')}),m.q('.team2-icon').setAttribute('src',l.Team2.TeamIconUrl),m.q('.team2-icon').setAttribute('alt',l.Team2.TeamName+' icon'),m.q('.team2-icon').addEventListener('load',function(){this.classList.add('loaded')});var p=new Date(l.MatchDateTimeUTC),q=App.Util.dateParser(p);m.q('.time').textContent=q;var r='more-container-'+l.MatchID;if(n.setAttribute('id',r),showMoreButton.setAttribute('aria-controls',r),showMoreButton.addEventListener('click',function(v){var w='true'===this.getAttribute('aria-expanded');w?(this.setAttribute('aria-expanded',!1),n.classList.remove('open'),this.setAttribute('title','Show additional information')):(this.setAttribute('aria-expanded',!0),n.classList.add('open'),this.setAttribute('title','Hide additional information'))}),l.MatchIsFinished){m.classList.add('finished');var t=2===l.MatchResults[0].ResultOrderID?0:1;m.q('.points-team1').textContent=l.MatchResults[t].PointsTeam1,m.q('.points-team2').textContent=l.MatchResults[t].PointsTeam2;var u=0;l.Goals.forEach(v=>{var w;v.ScoreTeam1>u?(w=1,u=v.ScoreTeam1):(w=2,v.ScoreTeam2);var x=o.q('li.template').cloneNode(!0);x.classList.add('goal-team-'+w),x.classList.remove('template'),x.q('.goal-scorer').innerHTML=v.GoalGetterName+'<span class="visuallyhidden">for team: '+l['Team'+w].TeamName+'</span>',x.q('.goal-time').textContent=v.MatchMinute,o.q('ul').appendChild(x)})}else new Date(l.MatchDateTime)<new Date?m.classList.add('ongoing'):(m.classList.add('not-started'),o.classList.add('hide'));App.Predictions?App.Predictions.render(m,l):void 0,k.appendChild(m),h()})})};return{online:!1,init:function(){App.Features.serviceWorker&&navigator.serviceWorker.register('./worker.js').then(h=>{void 0}).catch(h=>{void 0});let g=['js/util.js'];App.Features.store&&g.push('js/store.js'),App.Features.predictions&&g.push('js/predictions.js'),c(g).then(function(){return window.addEventListener('online',h=>{App.loadResults(),App.online=!0},!1),window.addEventListener('offline',h=>{App.online=!1},!1),(isOnline||navigator.onLine)&&(App.online=!0),App.loadResults()}).then(()=>{App.hideLoading(),App.Navigation&&App.Navigation.render()})},loadResults:function(g){App.showLoading(),App.hideOffline();let h=this.Navigation.getSelectedWeek(),i=location.protocol||'https:',j=useLocal?`http://localhost/bl/data/data-bl1-2016-${h}.json`:`${i}//www.openligadb.de/api/getmatchdata/bl1/2016/${h}`,k,l=function(){return a(j).then(function(m){let n=App.Util.resultParser(m);return App.Features.store&&App.Store.open().then(function(){return App.Store.add(h,n)}),new Promise(function(o,p){o(n)})},function(m){return g?App.showNotice('Unable to fetch data.'):App.showOffline()})};k=App.Features.store&&!g?App.Store.open().then(function(){return App.Store.get(h)}).then(function(m){return m?new Promise(function(n,o){n(m)}):l()}):a(j).then(m=>{let n=App.Util.resultParser(m);return App.Features.store&&App.Store.open().then(()=>{return App.Store.add(h,n)}),new Promise((o,p)=>{o(n)})},m=>{return g?App.showNotice('Unable to fetch data.'):App.showOffline()}),k.then(m=>{return m?f(m):void App.showOffline()}).then(()=>{App.hideLoading()})},showOffline:function(){if(this.online)return this.offline=!0,this.online=!1,a('offline.html').then(g=>{return new Promise((h,i)=>{var j=document.createElement('div');j.setAttribute('id','offline-container'),j.innerHTML=g,document.q('#results-container').appendChild(j),document.q('body').classList.add('offline'),h()})})},hideOffline:function(){if(this.offline){this.offline=!1,this.online=!0;let g=document.q('#offline-container');g&&g.remove(),document.q('body').classList.remove('offline')}},showNotice:function(g){return new Promise((h,i)=>{var j=document.createElement('div');j.classList.add('notice'),j.innerHTML=g,document.q('#container').appendChild(j),setTimeout(function(){j.remove()},5000),h()})},showLoading:function(){this.loading=!0,this.startedLoading=new Date,document.q('body').classList.add('loading'),clearTimeout(this.loadTimeout)},hideLoading:function(){let g=this,h=new Date-this.startedLoading,i=()=>{this.loading=!1,document.q('body').classList.remove('loading'),clearTimeout(this.loadTimeout)};500<h?i():this.loadTimeout=setTimeout(i,500-h)},Features:{predictions:'localStorage'in window,store:'indexedDB'in window,serviceWorker:'serviceWorker'in navigator,touch:'ontouchstart'in window},Navigation:function(){var g=new Date;g.setMinutes(0),g.setHours(0),g.setSeconds(0),g.setMilliseconds(0);var h=new Date('2016-08-25T00:00:00');return msPerWeek=604800000,weeksSinceSeasonStart=1+Math.floor((g-h)/msPerWeek),rendered=!1,regex=/#!\d{1,2}/,_updateLocation=i=>{location.hash=location.hash.match(regex)?location.hash.replace(regex,`#!${i}`):`#!${i}${location.hash}`},_getSelectedWeekFromLocation=()=>{var i=location.hash.match(regex);if(i)try{return parseInt(i[0].replace('#!',''))}catch(j){return void 0,null}else return null},selectedWeek=_getSelectedWeekFromLocation()||weeksSinceSeasonStart,{getWeeksSinceSeasonStart:function(){return weeksSinceSeasonStart},getSelectedWeek:function(){return selectedWeek},goToNextWeek:function(){selectedWeek++,_updateLocation(selectedWeek)},goToPrevWeek:function(){selectedWeek--,_updateLocation(selectedWeek)},isPrevButtonActive:function(){return 1<selectedWeek},isNextButtonActive:function(){return 34>selectedWeek},render:function(){var i=document.q('nav'),j=i.q('.prev'),k=i.q('.next');this.isPrevButtonActive()?j.removeAttribute('disabled'):j.setAttribute('disabled',!0),this.isNextButtonActive()?k.removeAttribute('disabled'):k.setAttribute('disabled',!0),i.q('.current-week').textContent=this.getSelectedWeek(),rendered||(goNextFn=l=>{App.loading||!this.isNextButtonActive||(this.goToNextWeek(),this.render(),App.loadResults())},goPrevFn=l=>{App.loading||!this.isPrevButtonActive||(this.goToPrevWeek(),this.render(),App.loadResults())},App.Features.touch&&c('js/app.js').then(function(){document.addEventListener('swipeleft',goNextFn),document.addEventListener('swiperight',goPrevFn)}),k.addEventListener('click',goNextFn),j.addEventListener('click',goPrevFn),rendered=!0)}}}()}})();App.init();