'use strict';var isOnline=-1!==location.hash.indexOf('online'),isOffline=-1!==location.hash.indexOf('offline'),useLocal=-1!==location.hash.indexOf('local'),noDB=-1!==location.hash.indexOf('noDB'),noStorage=-1!==location.hash.indexOf('noStorage'),noWorker=-1!==location.hash.indexOf('noWorker');Node.prototype.q=function(a){return this.querySelector(a)},Node.prototype.qA=function(a){return this.querySelectorAll(a)};var App=(()=>{var a=g=>{return new Promise((h,i)=>{var j=new XMLHttpRequest;j.open('GET',g,!0),j.onload=()=>{var k=-1===g.indexOf('http');k||200===j.status?k?setTimeout(function(){h(j.responseText)},2000):h(j.responseText):(void 0,i(new Error(j.statusText)))},j.onerror=k=>{void 0,i(k)},j.send()})},b=[],c=g=>{return'string'==typeof g&&(g=[g]),new Promise((h,i)=>{let j=0,k=l=>{++j===g.length&&(void 0,h())};g.forEach(l=>{if(-1<b.indexOf(l))return void k(l);b.push(l);var m=-1===l.indexOf('.js')?'css':'js';if('js'==m){var n=document.createElement('script');n.setAttribute('src',l),n.onload=k,'undefined'!=typeof n&&document.q('body').appendChild(n)}else if('css'==m){var n=document.createElement('link');n.setAttribute('rel','stylesheet'),n.setAttribute('href',l),n.onload=k,'undefined'!=typeof n&&document.q('head').appendChild(n)}})})},f=g=>{return new Promise((h,i)=>{document.qA('.result:not(.template)').forEach(m=>{m.remove()});var j=document.q('.result.template'),k=document.q('.results'),l=document.createDocumentFragment();g.forEach(m=>{var n=j.cloneNode(!0),o=n.q('.more-container'),p=o.q('.goals'),q=o.q('.predictions'),r=n.q('.shore-more-button');n.classList.remove('template'),n.setAttribute('data-match-id',m.MatchID),n.q('.team1-name').textContent=m.Team1.TeamName,n.q('.team2-name').textContent=m.Team2.TeamName,n.q('.team1-icon').setAttribute('src',m.Team1.TeamIconUrl.replace('http:',location.protocol)),n.q('.team1-icon').setAttribute('alt',m.Team1.TeamName+' icon'),n.q('.team1-icon').addEventListener('load',function(){this.classList.add('loaded')}),n.q('.team2-icon').setAttribute('src',m.Team2.TeamIconUrl.replace('http:',location.protocol)),n.q('.team2-icon').setAttribute('alt',m.Team2.TeamName+' icon'),n.q('.team2-icon').addEventListener('load',function(){this.classList.add('loaded')});var t=new Date(m.MatchDateTimeUTC),u=App.Util.dateParser(t);n.q('.time').textContent=u;var v='more-container-'+m.MatchID;if(o.setAttribute('id',v),r.setAttribute('aria-controls',v),r.addEventListener('click',function(y){var z='true'===this.getAttribute('aria-expanded');z?(this.setAttribute('aria-expanded',!1),o.classList.remove('open'),this.setAttribute('title','Show additional information')):(this.setAttribute('aria-expanded',!0),o.classList.add('open'),this.setAttribute('title','Hide additional information'))}),m.MatchIsFinished){n.classList.add('finished');var w=2===m.MatchResults[0].ResultOrderID?0:1;n.q('.points-team1').textContent=m.MatchResults[w].PointsTeam1,n.q('.points-team2').textContent=m.MatchResults[w].PointsTeam2;var x=0;m.Goals.forEach(y=>{var z;y.ScoreTeam1>x?(z=1,x=y.ScoreTeam1):(z=2,y.ScoreTeam2);let A=p.q('.heading'),B=p.q('li.template').cloneNode(!0);A.setAttribute('id',`goals-heading-${m.MatchID}`),B.classList.add('goal-team-'+z),B.classList.remove('template');let C=y.GoalGetterName||'<span class="visuallyhidden">Unknown</span><span aria-hidden="true">???</span>';B.q('.goal-scorer').innerHTML=C+'<span class="visuallyhidden">for team: '+m['Team'+z].TeamName+'</span>';let D=y.MatchMinute||'<span class="visuallyhidden">Unknown</span><span aria-hidden="true">??</span>';B.q('.goal-time').innerHTML=D,p.q('ul').setAttribute('aria-labelledby',`goals-heading-${m.MatchID}`),p.q('ul').appendChild(B)})}else new Date(m.MatchDateTime)<new Date?n.classList.add('ongoing'):(n.classList.add('not-started'),p.classList.add('hide'));App.Predictions?App.Predictions.render(n,m):(!m.MatchIsFinished&&r.classList.add('hide'),void 0),l.appendChild(n)}),k.appendChild(l),h()})};return{online:!1,init:function(){App.Features.serviceWorker&&navigator.serviceWorker.register('./worker.js').then(h=>{void 0}).catch(h=>{void 0});let g=['js/util.js','css/fonts.css'];App.Features.store&&g.push('js/store.js'),App.Features.predictions&&(g.push('js/predictions.js'),g.push('js/points.js')),c(g).then(()=>{return window.addEventListener('online',h=>{App.loadResults(),App.online=!0},!1),window.addEventListener('offline',h=>{App.online=!1},!1),(isOnline||navigator.onLine)&&(App.online=!0),App.loadResults()}).then(()=>{if(App.Navigation&&App.Navigation.render(),App.Points&&App.Store){let h=document.q('.points-button'),i=document.q('#prediction-points-container');h.addEventListener('click',function(j){var k='true'===this.getAttribute('aria-expanded');k?(this.setAttribute('aria-expanded',!1),this.setAttribute('title','Show points'),this.q('span').innerHTML='&empty;',document.q('body').classList.remove('points-visible')):(this.setAttribute('aria-expanded',!0),this.setAttribute('title','Hide points'),this.q('span').innerHTML='&times;',document.q('body').classList.add('points-visible'),i.focus())}),Promise.all([App.Store.open('data').then(()=>{return App.Store.getAll('data')}),App.Store.open('predictions').then(()=>{return App.Store.getAll('predictions')})]).then(j=>{let k=j[0],l=j[1];App.Points.renderAllPoints(document.q('#prediction-points-container'),k,l),h.classList.remove('hide')})}App.hideLoading()})},loadResults:function(g){App.showLoading(),App.hideOffline();let k,h=this.Navigation.getSelectedWeek(),i=location.protocol||'https:',j=useLocal?`http://localhost/bl/data/data-bl1-2016-${h}.json`:`${i}//www.openligadb.de/api/getmatchdata/bl1/2016/${h}`,l=function(){return a(j).then(function(m){let n=App.Util.resultParser(m);return App.store&&App.Store.open('data').then(function(){return App.Store.add('data',h,n)}),n},function(m){return g?App.showNotice('Unable to fetch data.'):App.showOffline()})};return k=App.Features.store&&!g?App.Store.open('data').then(()=>{return App.Store.get('data',h)}).then(function(m){return m?m:l()}):a(j).then(m=>{let n=App.Util.resultParser(m);return App.Features.store&&App.Store.open('data').then(()=>{return App.Store.add('data',h,n)}),n},m=>{return g?App.showNotice('Unable to fetch data.'):App.showOffline()}),k.then(m=>{return m?f(m):g?void 0:App.showOffline()}).then(()=>{return App.hideLoading()})},showOffline:function(){if(!this.offlineMessageVisible)return this.offline=!0,this.online=!1,this.offlineMessageVisible=!0,a('offline.html').then(g=>{return new Promise((h,i)=>{var j=document.createElement('div');j.setAttribute('id','offline-container'),j.innerHTML=g,document.q('#results-container').appendChild(j),document.q('body').classList.add('offline'),h()})})},hideOffline:function(){if(this.offlineMessageVisible){this.offline=!1,this.online=!0,this.offlineMessageVisible=!1;let g=document.q('#offline-container');g&&g.remove(),document.q('body').classList.remove('offline')}},showNotice:function(g){return new Promise((h,i)=>{var j=document.createElement('div');j.classList.add('notice'),j.innerHTML=g,document.q('#container').appendChild(j),setTimeout(function(){j.remove()},5000),h()})},showLoading:function(){this.loading=!0,this.startedLoading=new Date,document.q('body').classList.add('loading'),document.q('#container').setAttribute('aria-busy',!0),clearTimeout(this.loadTimeout)},hideLoading:function(){let g=this,h=new Date-this.startedLoading,i=()=>{this.loading=!1,document.q('body').classList.remove('loading'),document.q('#container').removeAttribute('aria-busy'),clearTimeout(this.loadTimeout)};500<h?i():this.loadTimeout=setTimeout(i,500-h)},Features:{predictions:'indexedDB'in window,store:'indexedDB'in window,serviceWorker:'serviceWorker'in navigator,touch:'ontouchstart'in window},Navigation:function(){var g=new Date;g.setMinutes(0),g.setHours(0),g.setSeconds(0),g.setMilliseconds(0);var h=new Date('2016-08-25T00:00:00'),i=1+Math.floor((g-h)/604800000),j=!1,k=/#!\d{1,2}/,l=n=>{location.hash=location.hash.match(k)?location.hash.replace(k,`#!${n}`):`#!${n}${location.hash}`},m=(()=>{var n=location.hash.match(k);if(n)try{return parseInt(n[0].replace('#!',''))}catch(o){return void 0,null}else return null})()||i;return{getWeeksSinceSeasonStart:function(){return i},getSelectedWeek:function(){return m},goToNextWeek:function(){m++,l(m)},goToPrevWeek:function(){m--,l(m)},isPrevButtonActive:function(){return 1<m},isNextButtonActive:function(){return 34>m},render:function(){var n=document.q('nav'),o=n.q('.prev'),p=n.q('.next');if(this.isPrevButtonActive()?o.removeAttribute('disabled'):o.setAttribute('disabled',!0),this.isNextButtonActive()?p.removeAttribute('disabled'):p.setAttribute('disabled',!0),n.q('.current-week').textContent=this.getSelectedWeek(),!j){var q=t=>{App.loading||!this.isNextButtonActive()||(this.goToNextWeek(),this.render(),App.loadResults())},r=t=>{App.loading||!this.isPrevButtonActive()||(this.goToPrevWeek(),this.render(),App.loadResults())};App.Features.touch&&c('js/app.js').then(function(){document.addEventListener('swipeleft',q),document.addEventListener('swiperight',r)}),p.addEventListener('click',q),o.addEventListener('click',r),j=!0}}}}()}})();App.init();