"use strict";var _this2=this;Node.prototype.q=function(e){return this.querySelector(e)},Node.prototype.qA=function(e){return this.querySelectorAll(e)},Node.prototype.on=function(e,t){return this.addEventListener(e,t)},Node.prototype.attr=function(e,t){return this.setAttribute(e,t)};var App=function(){var e=function(e){return new Promise(function(t,n){var i=new XMLHttpRequest;i.open("GET",e,!0),i.onload=function(){200===i.status?t(i.responseText):(void 0,n(new Error(i.statusText)))},i.onerror=function(t){void 0,n(t)},i.send()})},t=[],n=function(e){return"string"==typeof e&&(e=[e]),new Promise(function(n,i){var o=0,a=function(t){++o===e.length&&(void 0,n())};e.forEach(function(e){if(t.indexOf(e)>-1)return void a(e);t.push(e);var n=e.indexOf(".js")!==-1?"js":"css";if("js"===n){var i=document.createElement("script");i.attr("src",e),i.onload=a,document.q("body").appendChild(i)}else if("css"===n){var o=document.createElement("link");o.attr("rel","stylesheet"),o.attr("href",e),o.onload=a,document.q("head").appendChild(o)}})})},i=function(e){return new Promise(function(t,n){document.qA(".result:not(.template)").forEach(function(e){e.remove()});var i=document.q(".result.template"),o=document.q(".results"),a=document.createDocumentFragment();e.forEach(function(e){var t=i.cloneNode(!0),n=t.q(".more-container"),o=n.q(".goals"),r=(n.q(".predictions"),t.q(".shore-more-button"));t.classList.remove("template"),t.attr("data-match-id",e.MatchID),t.q(".team1-name").textContent=e.Team1.TeamName,t.q(".team2-name").textContent=e.Team2.TeamName,_this2.online&&(t.q(".team1-icon").attr("src",e.Team1.TeamIconUrl.replace("http:",location.protocol)),t.q(".team1-icon").attr("alt",e.Team1.TeamName+" icon"),t.q(".team1-icon").on("load",function(){this.classList.add("loaded")}),t.q(".team2-icon").attr("src",e.Team2.TeamIconUrl.replace("http:",location.protocol)),t.q(".team2-icon").attr("alt",e.Team2.TeamName+" icon"),t.q(".team2-icon").on("load",function(){this.classList.add("loaded")})),t.q(".time").textContent=App.Util.dateParser(new Date(e.MatchDateTimeUTC));var s="more-container-"+e.MatchID;n.attr("id",s),r.attr("aria-controls",s),r.on("click",function(e){var t="true"===this.getAttribute("aria-expanded");t?(this.attr("aria-expanded",!1),n.classList.remove("open"),this.attr("title","Show additional information")):(this.attr("aria-expanded",!0),n.classList.add("open"),this.attr("title","Hide additional information"))}),e.MatchIsFinished?!function(){t.classList.add("finished");var n=2===e.MatchResults[0].ResultOrderID?0:1;t.q(".points-team1").textContent=e.MatchResults[n].PointsTeam1,t.q(".points-team2").textContent=e.MatchResults[n].PointsTeam2;var i=0,a=0;e.Goals.forEach(function(t){var n=void 0;t.ScoreTeam1>i?(n=1,i=t.ScoreTeam1):(n=2,a=t.ScoreTeam2);var r=o.q(".heading"),s=o.q("li.template").cloneNode(!0);r.attr("id","goals-heading-"+e.MatchID),s.classList.add("goal-team-"+n),s.classList.remove("template");var c=t.GoalGetterName||'<span class="visuallyhidden">Unknown</span><span aria-hidden="true">???</span>';s.q(".goal-scorer").innerHTML=c+'<span class="visuallyhidden">for team: '+e["Team"+n].TeamName+"</span>";var d=t.MatchMinute||'<span class="visuallyhidden">Unknown</span><span aria-hidden="true">??</span>';s.q(".goal-time").innerHTML=d,o.q("ul").attr("aria-labelledby","goals-heading-"+e.MatchID),o.q("ul").appendChild(s)})}():new Date(e.MatchDateTime)<new Date?t.classList.add("ongoing"):(t.classList.add("not-started"),o.classList.add("hide")),App.Predictions?App.Predictions.render(t,e):(e.MatchIsFinished||r.classList.add("hide"),void 0),a.appendChild(t)}),o.appendChild(a),t()})};return{online:!1,init:function(){App.Features.serviceWorker&&navigator.serviceWorker.register("./worker.js").then(function(e){void 0}).catch(function(e){void 0});var e=["js/util.js","css/fonts.css"];App.Features.store&&e.push("js/store.js"),App.Features.predictions&&(e.push("js/predictions.js"),e.push("js/points.js")),n(e).then(function(){return window.addEventListener("online",function(e){App.loadResults(),App.online=!0},!1),window.addEventListener("offline",function(e){App.online=!1},!1),navigator.onLine&&(App.online=!0),App.loadResults()}).then(function(){App.Navigation&&App.Navigation.render(),App.Points&&App.Store&&!function(){var e=document.q(".points-button"),t=document.q("#prediction-points-container");e.on("click",function(e){var n="true"===this.getAttribute("aria-expanded");n?(this.attr("aria-expanded",!1),this.attr("title","Show points"),this.q("span").innerHTML="&empty;",document.q("body").classList.remove("points-visible")):(this.attr("aria-expanded",!0),this.attr("title","Hide points"),this.q("span").innerHTML="&times;",document.q("body").classList.add("points-visible"),t.focus())}),Promise.all([App.Store.open("data").then(function(){return App.Store.getAll("data")}),App.Store.open("predictions").then(function(){return App.Store.getAllPerIndex("predictions")})]).then(function(t){var n=t[0],i=t[1];App.Points.renderAllPoints(document.q("#prediction-points-container"),n,i),e.classList.remove("hide")})}(),App.hideLoading()})},loadResults:function(t){App.showLoading(),App.hideOffline();var n=this.Navigation.getSelectedWeek(),o=location.protocol||"https:",a=o+"//www.openligadb.de/api/getmatchdata/bl1/2016/"+n,r=void 0,s=function(){return e(a).then(function(e){var t=App.Util.resultParser(e);return App.store&&App.Store.open("data").then(function(){return App.Store.add("data",n,t)}),t},function(e){return t?App.showNotice("Unable to fetch data."):App.showOffline()})};return r=App.Store&&!t?App.Store.open("data").then(function(){return App.Store.get("data",n)}).then(function(e){return e?e:s()}):e(a).then(function(e){var t=App.Util.resultParser(e);return App.Features.store&&App.Store.open("data").then(function(){return App.Store.add("data",n,t)}),t},function(e){return t?App.showNotice("Unable to fetch data."):App.showOffline()}),r.then(function(e){return e?i(e):t?void 0:App.showOffline()}).then(function(){return App.hideLoading()})},showOffline:function(){if(!this.offlineMessageVisible)return this.offline=!0,this.online=!1,this.offlineMessageVisible=!0,e("offline.html").then(function(e){return new Promise(function(t,n){var i=document.createElement("div");i.attr("id","offline-container"),i.innerHTML=e,document.q("#results-container").appendChild(i),document.q("body").classList.add("offline"),t()})})},hideOffline:function(){if(this.offlineMessageVisible){this.offline=!1,this.online=!0,this.offlineMessageVisible=!1;var e=document.q("#offline-container");e&&e.remove(),document.q("body").classList.remove("offline")}},showNotice:function(e){return new Promise(function(t,n){var i=document.createElement("div");i.classList.add("notice"),i.innerHTML=e,document.q("#container").appendChild(i),setTimeout(function(){i.remove()},5e3),t()})},showLoading:function(){this.loading=!0,this.startedLoading=new Date,document.q("body").classList.add("loading"),document.q("#container").attr("aria-busy",!0),clearTimeout(this.loadTimeout)},hideLoading:function(){var e=this,t=new Date-this.startedLoading,n=function(){e.loading=!1,document.q("body").classList.remove("loading"),document.q("#container").removeAttribute("aria-busy"),clearTimeout(e.loadTimeout)};t>500?n():this.loadTimeout=setTimeout(n,500-t)},Features:{predictions:"indexedDB"in window,store:"indexedDB"in window,serviceWorker:"serviceWorker"in navigator,touch:"ontouchstart"in window},Navigation:function(){var e=new Date;e.setMinutes(0),e.setHours(0),e.setSeconds(0),e.setMilliseconds(0);var t=new Date("2016-08-25T00:00:00"),i=6048e5,o=1+Math.floor((e-t)/i),a=!1,r=/#!\d{1,2}/,s=function(e){location.hash.match(r)?location.hash=location.hash.replace(r,"#!"+e):location.hash="#!"+e+location.hash},c=function(){var e=location.hash.match(r);if(!e)return null;try{return parseInt(e[0].replace("#!",""))}catch(e){return void 0,null}},d=c()||o;return{getSelectedWeek:function(){return d},next:function(){d++,s(d)},prev:function(){d--,s(d)},isPrev:function(){return d>1},isNext:function(){return d<34},render:function(){var e=this,t=document.q("nav"),i=t.q(".prev"),o=t.q(".next");this.isPrev()?i.removeAttribute("disabled"):i.attr("disabled",!0),this.isNext()?o.removeAttribute("disabled"):o.attr("disabled",!0),t.q(".current-week").textContent=this.getSelectedWeek(),a||!function(){var t=function(t){!App.loading&&e.isNext()&&(e.next(),e.render(),App.loadResults())},r=function(t){!App.loading&&e.isPrev()&&(e.prev(),e.render(),App.loadResults())};App.Features.touch&&n("js/touch.js").then(function(){document.on("swipeleft",t),document.on("swiperight",r)}),o.on("click",t),i.on("click",r),a=!0}()}}}()}}();App.init();